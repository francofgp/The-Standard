<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Brokers/Brokers">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="alternate" type="application/rss+xml" href="/The-Standard/blog/rss.xml" title="The Standard ❤️ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/The-Standard/blog/atom.xml" title="The Standard ❤️ Atom Feed"><title data-rh="true">1 Brokers | The Standard ❤️</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://francofgp.github.io/The-Standard/docs/Brokers/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="1 Brokers | The Standard ❤️"><meta data-rh="true" name="description" content="1.0 Introduction"><meta data-rh="true" property="og:description" content="1.0 Introduction"><link data-rh="true" rel="icon" href="/The-Standard/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://francofgp.github.io/The-Standard/docs/Brokers/"><link data-rh="true" rel="alternate" href="https://francofgp.github.io/The-Standard/docs/Brokers/" hreflang="en"><link data-rh="true" rel="alternate" href="https://francofgp.github.io/The-Standard/docs/Brokers/" hreflang="x-default"><link rel="stylesheet" href="/The-Standard/assets/css/styles.95b304a2.css">
<link rel="preload" href="/The-Standard/assets/js/runtime~main.06584d35.js" as="script">
<link rel="preload" href="/The-Standard/assets/js/main.1bcd0719.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/The-Standard/"><div class="navbar__logo"><img src="/The-Standard/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/The-Standard/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">The Standard</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/The-Standard/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/The-Standard/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/The-Standard/docs/Introduction/">0 Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;0 Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/The-Standard/docs/Brokers/">1 Brokers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/The-Standard/docs/Services/">2 Services</a><button aria-label="Toggle the collapsible sidebar category &#x27;2 Services&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/The-Standard/docs/Exposers/">3 Exposers</a><button aria-label="Toggle the collapsible sidebar category &#x27;3 Exposers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/The-Standard/docs/intro">The Standard (v 2.0.1)</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/The-Standard/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">1 Brokers</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>1 Brokers</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="10-introduction">1.0 Introduction<a class="hash-link" href="#10-introduction" title="Direct link to heading">​</a></h2><p>Brokers play the role of a liaison between the business logic and the outside world.
They are wrappers around any external libraries, resources, services or APIs to satisfy a local interface for the business to interact with these resources without having to be tightly coupled with any particular resources or external library implementation.</p><p>Brokers in general are meant to be disposable and replaceable - they are built with the understanding that technology evolves and changes all the time and therefore they shall be at some point in time in the lifecycle of a given application be replaced with a modern technology that gets the job done faster.</p><p>But Brokers also ensure that your business is pluggable by abstracting away any specific external resource dependencies from what your software is actually trying to accomplish.</p><p>For instance, let&#x27;s say you have an API that was built to consume and serve data from a SQL server. At some point in time, you decided that a better more economical option for your API is to rely on a NoSql technology instead. Having a broker to abstract away the dependency on SQL will make it so much easier to simply integrate with NoSql with the least time and cost humanly possible.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="11-on-the-map">1.1 On The Map<a class="hash-link" href="#11-on-the-map" title="Direct link to heading">​</a></h2><p>In any given application, mobile, desktop, web or simply just an API - brokers usually reside at the &quot;tail&quot; of any app - that&#x27;s because they are the last point of contact between our custom code and the outside world.</p><p>Whether the outside world in this instance is just simply a local storage in memory, or an entirely independent system that resides behind an API, they all have to reside behind the Brokers in any application.</p><p>In the following low-level architecture for a given API - Brokers reside between our business logic and the external resource:</p><br><p><img loading="lazy" src="https://user-images.githubusercontent.com/1453985/148864693-d432be6f-13b1-4def-af95-9c63af430802.png" class="img_ev3q"></p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="12-characteristics">1.2 Characteristics<a class="hash-link" href="#12-characteristics" title="Direct link to heading">​</a></h2><p>There are few simple rules that govern the implementation of any broker - these rules are:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="120-implements-a-local-interface">1.2.0 Implements a Local Interface<a class="hash-link" href="#120-implements-a-local-interface" title="Direct link to heading">​</a></h3><p>Brokers have to satisfy a local contract. they have to implement a local interface to allow the decoupling between their implementation and the services that consume them.</p><p>For instance, given that we have a local contract <code>IStorageBroker</code> that requires an implementation for any given CRUD operation for a local model <code>Student</code> - the contract operation would be as follows:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    public partial interface IStorageBroker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IQueryable&lt;Student&gt; SelectAllStudents();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>An implementation for a storage broker would be as follows:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    public partial class StorageBroker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public DbSet&lt;Student&gt; Students { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public IQueryable&lt;Student&gt; SelectAllStudents()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            using var broker = new StorageBroker(this.configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return broker.Students;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A local contract implementation can be replaced at any point in time from utilizing the Entity Framework as shows in the previous example, to using a completely different technology like Dapper, or an entirely different infrastructure like an Oracle or PostgreSQL database.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="121-no-flow-control">1.2.1 No Flow Control<a class="hash-link" href="#121-no-flow-control" title="Direct link to heading">​</a></h3><p>Brokers should not have any form of flow-control such as if-statements, while-loops or switch cases - that&#x27;s simply because flow-control code is considered to be business logic, and it fits better the services layer where business logic should reside not the brokers.</p><p>For instance, a broker method that retrieves a list of students from a database would look something like this:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    public IQueryable&lt;Student&gt; SelectAllStudents()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        using var broker = new StorageBroker(this.configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return broker.Students;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A simple function that calls the native EntityFramework <code>DbSet&lt;T&gt;</code> and return a local model like <code>Student</code>. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="122-no-exception-handling">1.2.2 No Exception Handling<a class="hash-link" href="#122-no-exception-handling" title="Direct link to heading">​</a></h3><p>Exception handling is somewhat a form of flow-control. Brokers are not supposed to handle any exceptions, but rather let the exception propagate to the broker-neighboring services where these exceptions are going to be properly mapped and localized.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="123-own-their-configurations">1.2.3 Own Their Configurations<a class="hash-link" href="#123-own-their-configurations" title="Direct link to heading">​</a></h3><p>Brokers are also required to handle their own configurations - they may have a dependency injection from a configuration object, to retrieve and setup the configurations for whichever external resource they are integrating with.</p><p>For instance, connection strings in database communications are required to be retrieved and passed in to the database client to establish a successful connection, as follows:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    public partial class StorageBroker : EFxceptionsContext, IStorageBroker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private readonly IConfiguration configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public StorageBroker(IConfiguration configuration)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.configuration = configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.Database.Migrate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            string connectionString = this.configuration.GetConnectionString(&quot;DefaultConnection&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            optionsBuilder.UseSqlServer(connectionString);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="124-natives-from-primitives">1.2.4 Natives from Primitives<a class="hash-link" href="#124-natives-from-primitives" title="Direct link to heading">​</a></h3><p>Brokers may construct an external model object based on primitive types passed from the broker-neighboring services.</p><p>For instance, in e-mail notifications broker, input parameters for a <code>.Send(...)</code> function for instance require the basic input parameters such as the subject, content or the address for instance, here&#x27;s an example:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    public async ValueTask SendMailAsync(List&lt;string&gt; recipients, string subject, string content)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Message message = BuildMessage(recipients, ccRecipients, subject, content);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await SendEmailMessageAsync(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The primitive input parameters will ensure there are no strong dependencies between the broker-neighboring services and the external models.
Even in situations where the broker is simply a point of integration between your application and an external RESTful API, it&#x27;s very highly recommended that you build your own native models to reflect the same JSON object sent or returned from the API instead of relying on nuget libraries, dlls or shared projects to achieve the same goal.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="125-naming-conventions">1.2.5 Naming Conventions<a class="hash-link" href="#125-naming-conventions" title="Direct link to heading">​</a></h3><p>The contracts for the brokers shall remain as generic as possible to indicate the overall functionality of a broker, for instance we say <code>IStorageBroker</code> instead of <code>ISqlStorageBroker</code> to indicate a particular technology or infrastructure.</p><p>But in case of concrete implementations of brokers, it all depends on how many brokers you have providing similar functionality, in case of having a single storage broker, it might be more convenient to maintain the same name as the contract - in our case here a concrete implementation of <code>IStorageBroker</code> would be <code>StorageBroker</code>.</p><p>However, if your application supports multiple queues, storages or e-mail service providers you might need to start be specifying the overall target of the component, for instance, an <code>IQueueBroker</code> would have multiple implementations such as <code>NotificationQueueBroker</code> and <code>OrdersQueueBroker</code>.</p><p>But if the concrete implementations target the same model and business value, then a diversion to the technology might be more befitting in this case, for instance in the case of an <code>IStorageBroker</code> two different concrete implementations would be <code>SqlStorageBroker</code> and <code>MongoStorageBroker</code> this case is very possible in situations where environment costs are reduced in lower than production infrastructure for instance.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="126-language">1.2.6 Language<a class="hash-link" href="#126-language" title="Direct link to heading">​</a></h3><p>Brokers speak the language of the technologies they support.
For instance, in a storage broker, we say <code>SelectById</code> to match the SQL <code>Select</code> statement and in a queue broker we say <code>Enqueue</code> to match the language.</p><p>If a broker is supporting an API endpoint, then it shall follow the RESTFul operations language, such as <code>POST</code>, <code>GET</code> or <code>PUT</code>, here&#x27;s an example:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public async ValueTask&lt;Student&gt; PostStudentAsync(Student student) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await this.PostAsync(RelativeUrl, student);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="127-up--sideways">1.2.7 Up &amp; Sideways<a class="hash-link" href="#127-up--sideways" title="Direct link to heading">​</a></h3><p>Brokers cannot call other brokers. that&#x27;s simply because brokers are the first point of abstraction, they require no additional abstractions and no additional dependencies other than a configuration access model.</p><p>Brokers can&#x27;t also have services as dependencies as the flow in any given system shall come from the services to the brokers and not the other way around.</p><p>Even in situations where a microservice has to subscribe to a queue for instance, brokers will pass forward a listener method to process incoming events, but not call the services that provide the processing logic.</p><p>The general rule here then would be, that brokers can only be called by services, and they can only call external native dependencies.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="13-organization">1.3 Organization<a class="hash-link" href="#13-organization" title="Direct link to heading">​</a></h2><p>Brokers that support multiple entities such as Storage brokers should leverage partial classes to break down the responsibilities per entities.</p><p>For instance, if we have a storage broker that provides all CRUD operations for both <code>Student</code> and <code>Teacher</code> models, then the organization of the files should be as follows:</p><ul><li>IStorageBroker.cs<ul><li>IStorageBroker.Students.cs</li><li>IStorageBroker.Teachers.cs</li></ul></li><li>StorageBroker.cs<ul><li>StorageBroker.Students.cs</li><li>StorageBroker.Teachers.cs</li></ul></li></ul><p>The main purpose of this particular organization leveraging partial classes is to separate the concern for each entity to even a finer level, which should make the maintainability of the software much higher.</p><p>But brokers files and folders naming convention strictly focuses on the plurality of the entities they support and the singularity for the overall resource being supported.</p><p>For instance, we say <code>IStorageBroker.Students.cs</code>. and we also say <code>IEmailBroker</code> or <code>IQueueBroker.Notifications.cs</code> - singular for the resource and plural entities.</p><p>The same concept applies to the folders or namespaces containing these brokers.</p><p>For instance, we say:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace OtripleS.Web.Api.Brokers.Storages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And we say:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace OtripleS.Web.Api.Brokers.Queues</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="14-broker-types">1.4 Broker Types<a class="hash-link" href="#14-broker-types" title="Direct link to heading">​</a></h2><p>In most of the applications built today, there are some common Brokers that are usually needed to get an enterprise application up and running - some of these Brokers are like Storage, Time, APIs, Logging and Queues.</p><p>Some of these brokers interact with existing resources on the system such as time to allow broker-neighboring services to treat time as a dependency and control how a particular service would behave based on the value of time at any point in the past, present or the future.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="140-entity-brokers">1.4.0 Entity Brokers<a class="hash-link" href="#140-entity-brokers" title="Direct link to heading">​</a></h3><p>Entity brokers are the brokers providing integration points with external resources that the system needs to fulfill a business requirements.</p><p>For instance, entity brokers are brokers that integrate with storage, providing capabilities to store or retrieve records from a database.</p><p>Entity brokers are also like queue brokers, providing a point of integration to push messages to a queue for other services to consume and process to fulfill their business logic.</p><p>Entity brokers can only be called by broker-neighboring services, simply because they require a level of validation that needs to be performed on the data they receive or provide before proceeding any further.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="141-support-brokers">1.4.1 Support Brokers<a class="hash-link" href="#141-support-brokers" title="Direct link to heading">​</a></h3><p>Support brokers are general purpose brokers, they provide a functionality to support services but they have no characteristic that makes them different from one system or another.</p><p>A good example of support brokers is the <code>DateTimeBroker</code> - a broker made specifically to abstract away the business layer strong dependency on the system date time.</p><p>Time brokers don&#x27;t really target any specific entity, and they are almost the same across many systems out there.</p><p>Another example of support brokers is the <code>LoggingBroker</code> - they provide data to logging and monitoring systems to enable the system&#x27;s engineers to visualize the overall flow of data across the system, and be notified in case any issues occur.</p><p>Unlike Entity Brokers - support brokers may be called across the entire business layer, they may be called on foundation, processing, orchestration, coordination, management or aggregation services. that&#x27;s because logging brokers are required as a supporting component in the system to provide all the capabilities needed for services to log their errors or calculate a date or any other supporting functionality.</p><p>You can find real-world examples of brokers in the OtripleS project <a href="https://github.com/hassanhabib/OtripleS/tree/master/OtripleS.Web.Api/Brokers" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="15-implementation">1.5 Implementation<a class="hash-link" href="#15-implementation" title="Direct link to heading">​</a></h2><p>Here&#x27;s a real-life implementation of a full storage broker for all CRUD operations for <code>Student</code> entity:</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="for-istoragebrokercs">For IStorageBroker.cs:<a class="hash-link" href="#for-istoragebrokercs" title="Direct link to heading">​</a></h6><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace OtripleS.Web.Api.Brokers.Storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public partial interface IStorageBroker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithStickyNavbar_LWe7" id="for-storagebrokercs">For StorageBroker.cs:<a class="hash-link" href="#for-storagebrokercs" title="Direct link to heading">​</a></h6><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using EFxceptions.Identity;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using OtripleS.Web.Api.Models.Users;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace OtripleS.Web.Api.Brokers.Storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public partial class StorageBroker : EFxceptionsContext, IStorageBroker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private readonly IConfiguration configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public StorageBroker(IConfiguration configuration)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.configuration = configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.Database.Migrate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            string connectionString = this.configuration.GetConnectionString(&quot;DefaultConnection&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            optionsBuilder.UseSqlServer(connectionString);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithStickyNavbar_LWe7" id="for-istoragebrokerstudentscs">For IStorageBroker.Students.cs:<a class="hash-link" href="#for-istoragebrokerstudentscs" title="Direct link to heading">​</a></h6><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Linq;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Threading.Tasks;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using OtripleS.Web.Api.Models.Students;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace OtripleS.Web.Api.Brokers.Storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public partial interface IStorageBroker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public ValueTask&lt;Student&gt; InsertStudentAsync(Student student);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public IQueryable&lt;Student&gt; SelectAllStudents();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public ValueTask&lt;Student&gt; SelectStudentByIdAsync(Guid studentId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public ValueTask&lt;Student&gt; UpdateStudentAsync(Student student);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public ValueTask&lt;Student&gt; DeleteStudentAsync(Student student);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h6 class="anchor anchorWithStickyNavbar_LWe7" id="for-storagebrokerstudentscs">For StorageBroker.Students.cs:<a class="hash-link" href="#for-storagebrokerstudentscs" title="Direct link to heading">​</a></h6><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Linq;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Threading.Tasks;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore.ChangeTracking;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using OtripleS.Web.Api.Models.Students;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace OtripleS.Web.Api.Brokers.Storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public partial class StorageBroker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public DbSet&lt;Student&gt; Students { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public async ValueTask&lt;Student&gt; InsertStudentAsync(Student student)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            using var broker = new StorageBroker(this.configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            EntityEntry&lt;Student&gt; studentEntityEntry =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                await broker.Students.AddAsync(entity: student);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await broker.SaveChangesAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return studentEntityEntry.Entity;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public IQueryable&lt;Student&gt; SelectAllStudents()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            using var broker = new StorageBroker(this.configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return broker.Students;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public async ValueTask&lt;Student&gt; SelectStudentByIdAsync(Guid studentId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            using var broker = new StorageBroker(this.configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            broker.ChangeTracker.QueryTrackingBehavior =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                QueryTrackingBehavior.NoTracking;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return await broker.Students.FindAsync(studentId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public async ValueTask&lt;Student&gt; UpdateStudentAsync(Student student)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            using var broker = new StorageBroker(this.configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            EntityEntry&lt;Student&gt; studentEntityEntry =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                broker.Students.Update(entity: student);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await broker.SaveChangesAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return studentEntityEntry.Entity;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public async ValueTask&lt;Student&gt; DeleteStudentAsync(Student student)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            using var broker = new StorageBroker(this.configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            EntityEntry&lt;Student&gt; studentEntityEntry =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                broker.Students.Remove(entity: student);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await broker.SaveChangesAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return studentEntityEntry.Entity;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="16-summary">1.6 Summary<a class="hash-link" href="#16-summary" title="Direct link to heading">​</a></h2><p>Brokers are the first layer of abstraction between your business logic and the outside world, but they are not the only layer of abstraction. simply because there will still be few native models that leak through your brokers to your broker-neighboring services which is natural to avoid doing any mappings outside of the realm of logic, in our case here the foundation services.</p><p>For instance, in a storage broker, regardless what ORM you are using, some native exceptions from your ORM (EntityFramework for instance) will occur, such as <code>DbUpdateException</code> or <code>SqlException</code> - in that case we need another layer of abstraction to play the role of a mapper between these exceptions and our core logic to convert them into local exception models. </p><p>This responsibility lies in the hands of the broker-neighboring services, I also call them foundation services, these services are the last point of abstraction before your core logic, in which everything becomes nothing but local models and contracts.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="17-faqs">1.7 FAQs<a class="hash-link" href="#17-faqs" title="Direct link to heading">​</a></h2><p>During the course of time, there have been some common questions that arose by the engineers that I had the opportunity to work with throughout my career - since some of these questions reoccurred on several occasions, I thought it might be useful to aggregate all of them in here for everyone to learn about some other perspectives around brokers.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="170-is-the-brokers-pattern-the-same-as-the-repository-pattern">1.7.0 Is the brokers pattern the same as the repository pattern?<a class="hash-link" href="#170-is-the-brokers-pattern-the-same-as-the-repository-pattern" title="Direct link to heading">​</a></h4><p>Not exactly, at least from an operational standpoint, brokers seems to be more generic than repositories.</p><p>Repositories usually target storage-like operations, mainly towards databases. but brokers can be an integration point with any external dependency such as e-mail services, queues, other APIs and such.</p><p>A more similar pattern for brokers is the Unit of Work pattern, it mainly focuses on the overall operation without having to tie the definition or the name with any particular operation.</p><p>All of these patterns in general try to achieve the same SOLID principles goal, which is the separation of concern, dependency injection and single responsibility.</p><p>But because SOLID are principles and not exact guidelines, it&#x27;s expected to see all different kinds of implementations and patterns to achieve that principle.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="171-why-cant-the-brokers-implement-a-contract-for-methods-that-return-an-interface-instead-of-a-concrete-model">1.7.1 Why can&#x27;t the brokers implement a contract for methods that return an interface instead of a concrete model?<a class="hash-link" href="#171-why-cant-the-brokers-implement-a-contract-for-methods-that-return-an-interface-instead-of-a-concrete-model" title="Direct link to heading">​</a></h4><p>That would be an ideal situation, but that would also require brokers to do a conversion or mapping between the native models returned from the external resource SDKs or APIs and the internal model that adheres to the local contract.</p><p>Doing that on the broker level will require pushing business logic into that realm, which is outside of the purpose of that component completely.</p><p>Brokers do not get unit tested because they have no business logic in them, they may be a part of an acceptance or an integration test, but certainly not a part of unit level tests - simply because they don&#x27;t contain any business logic in them. We define business logic code as any intended sequential, selective or iteration code.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="172-if-brokers-were-truly-a-layer-of-abstraction-from-the-business-logic-how-come-we-allow-external-exceptions-to-leak-through-them-onto-the-services-layer">1.7.2 If brokers were truly a layer of abstraction from the business logic, how come we allow external exceptions to leak through them onto the services layer?<a class="hash-link" href="#172-if-brokers-were-truly-a-layer-of-abstraction-from-the-business-logic-how-come-we-allow-external-exceptions-to-leak-through-them-onto-the-services-layer" title="Direct link to heading">​</a></h4><p>Brokers are only the <em>the first</em> layer of abstraction, but not the only one - the broker neighboring services are responsible for converting the native exceptions occurring from a broker into a more local exception model that can be handled and processed internally within the business logic realm.</p><p>Full pure local code starts to occur on the processing, orchestration, coordination and aggregation layers where all the exceptions, all the returned models and all operations are localized to the system.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="173-why-do-we-use-partial-classes-for-brokers-who-handle-multiple-entities">1.7.3 Why do we use partial classes for brokers who handle multiple entities?<a class="hash-link" href="#173-why-do-we-use-partial-classes-for-brokers-who-handle-multiple-entities" title="Direct link to heading">​</a></h4><p>Since brokers are required to own their own configurations, it made more sense to partialize when possible to avoid reconfiguring every storage broker for each entity.</p><p>This is a feature in C# specifically as a language, but it should be possible to implement through inheritance in other programming languages.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="174-are-brokers-the-same-as-providers-provider-pattern">1.7.4 Are brokers the same as providers (Provider Pattern)?<a class="hash-link" href="#174-are-brokers-the-same-as-providers-provider-pattern" title="Direct link to heading">​</a></h4><p>No. Providers blur the line between services (business logic) and brokers (integration layer) - brokers are targeting particular components within the system that are disposable. Providers seem to include more than just that.</p><p>[*][Implementing Abstract Components (Brokers)]<!-- -->(<a href="https://www.youtube.com/watch?v=6NlgSskQXSo" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=6NlgSskQXSo</a>)</p><p>[*][Implementing Abstract Components (Part 2)]<!-- -->(<a href="https://www.youtube.com/watch?v=d1cqEKMBmno" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=d1cqEKMBmno</a>)</p><p>[*][Generating Model Migrations w/ EntityFramework]<!-- -->(<a href="https://www.youtube.com/watch?v=6sD5zz9BuOk" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=6sD5zz9BuOk</a>)</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/1. Brokers/1. Brokers.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/The-Standard/docs/Introduction/0.2 Principles"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">0.2 Principles</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/The-Standard/docs/Services/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">2 Services</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#10-introduction" class="table-of-contents__link toc-highlight">1.0 Introduction</a></li><li><a href="#11-on-the-map" class="table-of-contents__link toc-highlight">1.1 On The Map</a></li><li><a href="#12-characteristics" class="table-of-contents__link toc-highlight">1.2 Characteristics</a><ul><li><a href="#120-implements-a-local-interface" class="table-of-contents__link toc-highlight">1.2.0 Implements a Local Interface</a></li><li><a href="#121-no-flow-control" class="table-of-contents__link toc-highlight">1.2.1 No Flow Control</a></li><li><a href="#122-no-exception-handling" class="table-of-contents__link toc-highlight">1.2.2 No Exception Handling</a></li><li><a href="#123-own-their-configurations" class="table-of-contents__link toc-highlight">1.2.3 Own Their Configurations</a></li><li><a href="#124-natives-from-primitives" class="table-of-contents__link toc-highlight">1.2.4 Natives from Primitives</a></li><li><a href="#125-naming-conventions" class="table-of-contents__link toc-highlight">1.2.5 Naming Conventions</a></li><li><a href="#126-language" class="table-of-contents__link toc-highlight">1.2.6 Language</a></li><li><a href="#127-up--sideways" class="table-of-contents__link toc-highlight">1.2.7 Up &amp; Sideways</a></li></ul></li><li><a href="#13-organization" class="table-of-contents__link toc-highlight">1.3 Organization</a></li><li><a href="#14-broker-types" class="table-of-contents__link toc-highlight">1.4 Broker Types</a><ul><li><a href="#140-entity-brokers" class="table-of-contents__link toc-highlight">1.4.0 Entity Brokers</a></li><li><a href="#141-support-brokers" class="table-of-contents__link toc-highlight">1.4.1 Support Brokers</a></li></ul></li><li><a href="#15-implementation" class="table-of-contents__link toc-highlight">1.5 Implementation</a></li><li><a href="#16-summary" class="table-of-contents__link toc-highlight">1.6 Summary</a></li><li><a href="#17-faqs" class="table-of-contents__link toc-highlight">1.7 FAQs</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/The-Standard/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/The-Standard/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/The-Standard/assets/js/runtime~main.06584d35.js"></script>
<script src="/The-Standard/assets/js/main.1bcd0719.js"></script>
</body>
</html>